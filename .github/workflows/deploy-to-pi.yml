name: Deploy to Raspberry Pi

on:
  workflow_run:
    workflows: ["Build and Push Docker Image"]
    types:
      - completed

jobs:
  deploy:
    runs-on: self-hosted  # This will run on your Pi
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Deploy Docker container to Raspberry Pi
        run: |
          cd /mnt/storage/cst_590_computer_science_capstone_project
          docker compose pull
          docker compose up -d
          
      - name: Install Pi-specific packages in container
        run: |
          docker exec traffic-monitoring-edge pip install picamera2 gpiozero RPi.GPIO gpustat
