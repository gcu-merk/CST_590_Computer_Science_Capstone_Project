╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                    RASPBERRY PI 5 TRAFFIC MONITORING SYSTEM ARCHITECTURE              ║
║                          (Pi 5 Optimized with Recommended Improvements)               ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    HARDWARE LAYER                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────┐  ┌─────────────────┐  ┌───────────────────┐  ┌─────────────────┐ │
│  │   Raspberry Pi 5  │  │ Sony IMX500 AI  │  │   OPS243-C        │  │  External SSD   │ │
│  │ ┌──────────────┐  │  │    Camera       │  │ FMCW Radar        │  │    Storage      │ │
│  │ │ARM Cortex-A76│  │  │ ┌─────────────┐ │  │ ┌───────────────┐ │  │ ┌─────────────┐ │ │
│  │ │  4 Cores     │  │  │ │On-chip AI   │ │  │ │24.125 GHz     │ │  │ │  Fast I/O   │ │ │
│  │ │  2.4GHz      │  │  │ │Processing   │ │  │ │UART Interface │ │  │ │  512GB+     │ │ │
│  │ └──────────────┘  │  │ └─────────────┘ │  │ └───────────────┘ │  │ └─────────────┘ │ │
│  │ ┌─────────────┐   │  │ ┌─────────────┐ │  │ ┌────────────────┐│  │                 │ │
│  │ │VideoCore VII│   │  │ │1920x1080@30 │ │  │ │Speed Detection ││  │                 │ │
│  │ │   GPU       │   │  │ │   fps       │ │  │ │0-200+ mph      ││  │                 │ │
│  │ │  128MB VRAM │   │  │ │             │ │  │ │                ││  │                 │ │
│  │ └─────────────┘   │  │ └─────────────┘ │  │ └────────────────┘│  │                 │ │
│  │ ┌─────────────┐   │  └─────────────────┘  └───────────────────┘  └─────────────────┘ │
│  │ │   16GB      │   │           │                      │                               │
│  │ │  LPDDR5     │   │           │                      │                               │
│  │ │             │   │    ┌──────▼──────┐        ┌──────▼──────┐                        │
│  │ └─────────────┘   │    │ picamera2   │        │   GPIO      │                        │
│  └───────────────────┘    │ Interface   │        │ /dev/ttyACM0│                        │
│                           └─────────────┘        └─────────────┘                        │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                                  EDGE PROCESSING LAYER                                ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║  ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                          main_edge_app.py                                       │  ║
║  │                        Edge Orchestrator                                        │  ║
║  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────┐    │  ║
║  │  │Service Manager  │ │Health Monitor   │ │Event Dispatcher │ │Config Mgr   │    │  ║
║  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────┘    │  ║
║  └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                        │                                              ║
║  ┌──────────────────┬──────────────────┬──────────────────┬──────────────────────┐    ║
║  │                  │                  │                  │                      │    ║
║  ▼                  ▼                  ▼                  ▼                      │    ║
║ ┌─────────────────┐┌─────────────────┐┌─────────────────┐┌─────────────────────┐ │    ║
║ │Vehicle Detection││Speed Analysis   ││Data Fusion      ││System Health        │ │    ║
║ │    Service      ││    Service      ││    Engine       ││   Monitor           │ │    ║
║ ├─────────────────┤├─────────────────┤├─────────────────┤├─────────────────────┤ │    ║
║ │┌───────────────┐││┌───────────────┐││┌───────────────┐││┌───────────────────┐│ │    ║
║ ││ TensorFlow    ││││  OPS243-C     ││││  Kalman       ││││  CPU/Memory       ││ │    ║
║ ││   Lite        ││││  Interface    ││││  Filter       ││││  Monitoring       ││ │    ║
║ ││ Inference     ││││               ││││               ││││                   ││ │    ║
║ │└───────────────┘││└───────────────┘││└───────────────┘││└───────────────────┘│ │    ║
║ │┌───────────────┐││┌───────────────┐││┌───────────────┐││┌───────────────────┐│ │    ║
║ ││ picamera2     ││││  GPIO Control ││││  Temporal     ││││  GPU Temperature  ││ │    ║
║ ││ Interface     ││││  (gpiozero)   ││││  Smoothing    ││││  Monitoring       ││ │    ║
║ ││               ││││               ││││               ││││                   ││ │    ║
║ │└───────────────┘││└───────────────┘││└───────────────┘││└───────────────────┘│ │    ║
║ │┌───────────────┐││┌───────────────┐││┌───────────────┐││┌───────────────────┐│ │    ║
║ ││ YOLO/MobileNet││││  Serial UART  ││││  Multi-Object ││││  Performance      ││ │    ║
║ ││ Models        ││││  Communication││││  Tracking     ││││  Metrics          ││ │    ║
║ ││               ││││               ││││  (SORT)       ││││                   ││ │    ║
║ │└───────────────┘││└───────────────┘││└───────────────┘││└───────────────────┘│ │    ║
║ └─────────────────┘└─────────────────┘└─────────────────┘└─────────────────────┘ │    ║
║                                         │                                        │    ║
║                             ┌───────────▼───────────┐                            │    ║
║                             │    Data Flow Bus      │                            │    ║
║                             │  (Thread-Safe Queue)  │                            │    ║
║                             └───────────┬───────────┘                            │    ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝
╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                                  API GATEWAY LAYER                                    ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║  ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                        edge_api_gateway.py                                      │  ║
║  │                       Flask-SocketIO Server                                     │  ║
║  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────┐    │  ║
║  │  │REST API         │ │WebSocket        │ │CORS Handler     │ │Rate Limiter │    │  ║
║  │  │Endpoints        │ │Event Handler    │ │                 │ │             │    │  ║
║  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────┘    │  ║
║  └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                         │                                             ║
║  ┌──────────────────┬──────────────────┬──────────────────┬──────────────────────┐    ║
║  │                  │                  │                  │                      │    ║
║  ▼                  ▼                  ▼                  ▼                      │    ║
║ ┌─────────────────┐┌─────────────────┐┌─────────────────┐┌─────────────────────┐ │    ║
║ │/api/detections  ││/api/speed       ││/api/health      ││WebSocket Events     │ │    ║
║ │                 ││                 ││                 ││                     │ │    ║
║ │GET/POST         ││GET/POST         ││GET              ││• detection_update   │ │    ║
║ │Vehicle data     ││Speed data       ││System status    ││• speed_update       │ │    ║
║ │JSON response    ││JSON response    ││JSON response    ││• health_update      │ │    ║
║ └─────────────────┘└─────────────────┘└─────────────────┘└─────────────────────┘ │    ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝
                                         │
╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                                  DATA PERSISTENCE LAYER                               ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║  ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                         data_persister.py                                       │  ║
║  │                       SQLite Database Manager                                   │  ║
║  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────┐    │  ║
║  │  │Connection Pool  │ │Transaction Mgr  │ │Schema Manager   │ │Backup Mgr   │    │  ║
║  │  │(SQLite WAL)     │ │                 │ │                 │ │             │    │  ║
║  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────┘    │  ║
║  └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                         │                                             ║
║  ┌──────────────────┬──────────────────┬──────────────────┬──────────────────────┐    ║
║  │                  │                  │                  │                      │    ║
║  ▼                  ▼                  ▼                  ▼                      │    ║
║ ┌─────────────────┐┌─────────────────┐┌─────────────────┐┌─────────────────────┐ │    ║
║ │vehicle_detections││speed_measurements││system_health    ││export_data        │ │    ║
║ │                 ││                 ││                 ││                     │ │    ║
║ │• id (PRIMARY)   ││• id (PRIMARY)   ││• timestamp      ││• csv_export()       │ │    ║
║ │• timestamp      ││• timestamp      ││• cpu_usage      ││• json_export()      │ │    ║
║ │• vehicle_id     ││• vehicle_id     ││• memory_usage   ││• backup_database()  │ │    ║
║ │• bbox           ││• speed_mph      ││• gpu_temp       ││                     │ │    ║
║ │• confidence     ││• radar_freq     ││• disk_usage     ││                     │ │    ║
║ │• vehicle_type   ││• accuracy       ││                 ││                     │ │    ║
║ └─────────────────┘└─────────────────┘└─────────────────┘└─────────────────────┘ │    ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝
                                         │
╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                                  DEPLOYMENT LAYER                                     ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║  ┌─────────────────────────────────────────────────────────────────────────────────┐  ║
║  │                            Docker Container                                     │  ║
║  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────┐    │  ║
║  │  │Base Image       │ │Hardware Access  │ │Volume Mounts    │ │Environment  │    │  ║
║  │  │python:3.11-slim │ │/dev/video0      │ │./data:/app/data │ │Variables    │    │  ║
║  │  │                 │ │/dev/ttyACM0     │ │./logs:/app/logs │ │             │    │  ║
║  │  │                 │ │/dev/gpiomem     │ │./config:/config │ │             │    │  ║
║  │  └─────────────────┘ └─────────────────┘ └─────────────────┘ └─────────────┘    │  ║
║  └─────────────────────────────────────────────────────────────────────────────────┘  ║
║                                         │                                             ║
║  ┌──────────────────┬──────────────────┬──────────────────┬──────────────────────┐    ║
║  │                  │                  │                  │                      │    ║
║  ▼                  ▼                  ▼                  ▼                      │    ║
║ ┌─────────────────┐┌─────────────────┐┌─────────────────┐┌─────────────────────┐ │    ║
║ │System Service   ││Health Checks    ││Log Management   ││Performance Monitor  │ │    ║
║ │                 ││                 ││                 ││                     │ │    ║
║ │systemctl        ││Docker health    ││Centralized      ││Resource usage       │ │    ║
║ │auto-restart     ││endpoint         ││logging          ││GPU monitoring       │ │    ║
║ │boot-on-start    ││/health          ││JSON format      ││Memory optimization  │ │    ║
║ └─────────────────┘└─────────────────┘└─────────────────┘└─────────────────────┘ │    ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                              DATA FLOW DIAGRAM                                        ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                       ║
║  Camera Input          Radar Input                    System Monitoring               ║
║       │                    │                               │                          ║
║       ▼                    ▼                               ▼                          ║
║ ┌─────────────┐      ┌─────────────┐                ┌─────────────┐                   ║
║ │picamera2    │      │GPIO/Serial  │                │psutil +     │                   ║
║ │Frame Capture│      │UART Reader  │                │GPU Monitor  │                   ║
║ └─────────────┘      └─────────────┘                └─────────────┘                   ║
║       │                    │                               │                          ║
║       ▼                    ▼                               ▼                          ║
║ ┌─────────────┐      ┌─────────────┐                ┌─────────────┐                   ║
║ │TensorFlow   │      │Speed        │                │Health       │                   ║
║ │Lite         │      │Calculation  │                │Metrics      │                   ║
║ │Inference    │      │             │                │Collection   │                   ║
║ └─────────────┘      └─────────────┘                └─────────────┘                   ║
║       │                    │                               │                          ║
║       └────────────────────┼───────────────────────────────┘                          ║
║                            ▼                                                          ║
║                    ┌─────────────┐                                                    ║
║                    │Data Fusion  │                                                    ║
║                    │Engine       │                                                    ║
║                    │(Kalman)     │                                                    ║
║                    └─────────────┘                                                    ║
║                            │                                                          ║
║                            ▼                                                          ║
║              ┌─────────────────────────────┐                                          ║
║              │    Thread-Safe Queue        │                                          ║
║              │    (asyncio.Queue)          │                                          ║
║              └─────────────────────────────┘                                          ║
║                            │                                                          ║
║            ┌───────────────┼───────────────┐                                          ║
║            ▼               ▼               ▼                                          ║
║    ┌─────────────┐ ┌───────────────┐ ┌─────────────┐                                  ║
║    │SQLite       │ │Flask-SocketIO │ │WebSocket    │                                  ║
║    │Database     │ │REST API       │ │Broadcast    │                                  ║
║    │Storage      │ │               │ │             │                                  ║
║    └─────────────┘ └───────────────┘ └─────────────┘                                  ║
║                                                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════════════════════╗
║                              TECHNOLOGY STACK                                         ║
╠═══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                       ║
║  HARDWARE OPTIMIZATIONS                    SOFTWARE OPTIMIZATIONS                     ║
║  ├─ Raspberry Pi 5 (ARM Cortex-A76)       ├─ Python 3.11+                             ║
║  ├─ Sony IMX500 AI Camera                  ├─ TensorFlow Lite (Edge Inference)        ║
║  ├─ OPS243-C FMCW Doppler Radar           ├─ OpenCV (Computer Vision)                 ║
║  ├─ 16GB LPDDR5 RAM                       ├─ picamera2 (Pi Camera Interface)          ║
║  ├─ VideoCore VII GPU (128MB)             ├─ gpiozero + RPi.GPIO (Hardware)           ║
║  └─ External SSD Storage                   ├─ Flask-SocketIO (Real-time API)          ║
║                                           ├─ SQLite (Edge Database)                   ║
║  DEPLOYMENT STACK                          ├─ Docker (Containerization)               ║
║  ├─ Docker + docker-compose               ├─ systemd (Service Management)             ║
║  ├─ Hardware device mapping               ├─ psutil (System Monitoring)               ║
║  ├─ Privileged container access           └─ SORT Algorithm (Multi-tracking)          ║
║  ├─ Volume persistence                                                                ║
║  └─ Auto-restart capabilities              PERFORMANCE FEATURES                       ║
║                                           ├─ GPU Memory Split (128MB)                 ║
║  COMMUNICATION PROTOCOLS                   ├─ ARM NEON Optimizations                  ║
║  ├─ UART (Radar Communication)            ├─ Multi-threaded Processing                ║
║  ├─ WebSocket (Real-time Updates)          ├─ Memory Pool Management                  ║
║  ├─ REST API (Standard Interface)          ├─ SQLite WAL Mode                         ║
║  ├─ JSON (Data Serialization)             ├─ Async I/O Operations                     ║
║  └─ HTTP/HTTPS (Web Interface)             └─ Kalman Filter Smoothing                 ║
║                                                                                       ║
╚═══════════════════════════════════════════════════════════════════════════════════════╝